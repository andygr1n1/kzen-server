import{u as qr,b as zr,f as Ur,a as Yr,I as Wr}from"./IconNew-BhAnMb5r.js";import{b as oe,a as M,c as we,d as dt}from"./types-BpX3pQkR.js";import{ar as Kr,as as Vr,aR as ht,aS as Hr,aT as Qr,h as Xr,aU as vt,x as mt,j as d,P as z,O as Y,J as W,Q as St,U as Jr,aF as Zr,G as le,u as Be,aV as xt,aW as ae,ab as Et}from"./index-Cx9aHWms.js";import{s as qe,f as Oe,a as en,c as Rt}from"./date.helpers-BWySBUrV.js";import{o as Dt,p as tn,q as rn,a as Nt,j as nn,d as ie,c as an,r as on,I as sn,k as un,X as cn}from"./ProtectedRoutes-BInEfiaw.js";import{I as ln}from"./IconEye-DfyAN8Gq.js";import{X as Se}from"./XTooltip-Bdc9vu0b.js";import{S as se}from"./formik.esm-ADxEa5mi.js";import{I as fn}from"./IconHeart-CwlJhkiG.js";import{g as dn}from"./antd-bK47dtYc.js";import{u as fe}from"./useMutation-D6aZmw1J.js";import{g as q,K as Me,I as hn}from"./IconCheck-DtfZ8jdC.js";import{c as _t,a as re}from"./cn-Bz47sbbS.js";import{d as ye,s as Ie,k as vn,l as mn,b as _n}from"./react-day-picker-BMg2DGmo.js";import{t as pn}from"./debounce-CqMFxJgi.js";var pt=1/0,gn=17976931348623157e292;function yn(r){if(!r)return r===0?r:0;if(r=pn(r),r===pt||r===-pt){var a=r<0?-1:1;return a*gn}return r===r?r:0}function bn(r){var a=yn(r),u=a%1;return a===a?u?a-u:a:0}var In="[object RegExp]";function wn(r){return Kr(r)&&Vr(r)==In}var gt=ht&&ht.isRegExp,Sn=gt?Hr(gt):wn,xn=Qr("length"),At="\\ud800-\\udfff",En="\\u0300-\\u036f",Rn="\\ufe20-\\ufe2f",Dn="\\u20d0-\\u20ff",Nn=En+Rn+Dn,An="\\ufe0e\\ufe0f",Tn="["+At+"]",Le="["+Nn+"]",Pe="\\ud83c[\\udffb-\\udfff]",Cn="(?:"+Le+"|"+Pe+")",Tt="[^"+At+"]",Ct="(?:\\ud83c[\\udde6-\\uddff]){2}",$t="[\\ud800-\\udbff][\\udc00-\\udfff]",$n="\\u200d",Ft=Cn+"?",jt="["+An+"]?",Fn="(?:"+$n+"(?:"+[Tt,Ct,$t].join("|")+")"+jt+Ft+")*",jn=jt+Ft+Fn,Gn="(?:"+[Tt+Le+"?",Le,Ct,$t,Tn].join("|")+")",yt=RegExp(Pe+"(?="+Pe+")|"+Gn+jn,"g");function Mn(r){for(var a=yt.lastIndex=0;yt.test(r);)++a;return a}function kn(r){return Dt(r)?Mn(r):xn(r)}var On=30,Ln="...",Pn=/\w*$/;function Bn(r,a){var u=On,c=Ln;if(Xr(a)){var f="separator"in a?a.separator:f;u="length"in a?bn(a.length):u,c="omission"in a?vt(a.omission):c}r=mt(r);var m=r.length;if(Dt(r)){var b=tn(r);m=b.length}if(u>=m)return r;var y=u-kn(c);if(y<1)return c;var x=b?rn(b,0,y).join(""):r.slice(0,y);if(f===void 0)return x+c;if(b&&(y+=x.length-y),Sn(f)){if(r.slice(y).search(f)){var D,L=x;for(f.global||(f=RegExp(f.source,mt(Pn.exec(f))+"g")),f.lastIndex=0;D=f.exec(L);)var g=D.index;x=x.slice(0,g===void 0?y:g)}}else if(r.indexOf(vt(f),y)!=y){var w=x.lastIndexOf(f);w>-1&&(x=x.slice(0,w))}return x+c}function qn(r){return d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",viewBox:"0 0 24 24",...r,children:[d.jsxs("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeWidth:2,children:[d.jsxs("g",{children:[d.jsx("path",{strokeDasharray:4,strokeDashoffset:4,d:"M12 3V5",children:d.jsx("animate",{fill:"freeze",attributeName:"stroke-dashoffset",dur:"0.2s",values:"4;0"})}),d.jsxs("path",{fill:"currentColor",fillOpacity:0,strokeDasharray:28,strokeDashoffset:28,d:"M12 5C8.68629 5 6 7.68629 6 11L6 17C5 17 4 18 4 19H12M12 5C15.3137 5 18 7.68629 18 11L18 17C19 17 20 18 20 19H12",children:[d.jsx("animate",{fill:"freeze",attributeName:"stroke-dashoffset",begin:"0.2s",dur:"0.4s",values:"28;0"}),d.jsx("animate",{fill:"freeze",attributeName:"fill-opacity",begin:"0.8s",dur:"0.15s",values:"0;0.3"})]}),d.jsx("animateTransform",{attributeName:"transform",begin:"0.8s",dur:"6s",keyTimes:"0;0.05;0.15;0.2;1",repeatCount:"indefinite",type:"rotate",values:"0 12 3;3 12 3;-3 12 3;0 12 3;0 12 3"})]}),d.jsxs("path",{strokeDasharray:8,strokeDashoffset:8,d:"M10 20C10 21.1046 10.8954 22 12 22C13.1046 22 14 21.1046 14 20",children:[d.jsx("animate",{fill:"freeze",attributeName:"stroke-dashoffset",begin:"0.6s",dur:"0.2s",values:"8;0"}),d.jsx("animateTransform",{attributeName:"transform",begin:"1s",dur:"6s",keyTimes:"0;0.05;0.15;0.2;1",repeatCount:"indefinite",type:"rotate",values:"0 12 8;6 12 8;-6 12 8;0 12 8;0 12 8"})]}),d.jsxs("path",{strokeDasharray:8,strokeDashoffset:8,d:"M22 6v4",opacity:0,children:[d.jsx("set",{attributeName:"opacity",begin:"1s",to:1}),d.jsx("animate",{fill:"freeze",attributeName:"stroke-dashoffset",begin:"1s",dur:"0.2s",values:"8;0"}),d.jsx("animate",{attributeName:"stroke-width",begin:"1.7s",dur:"3s",keyTimes:"0;0.1;0.2;0.3;1",repeatCount:"indefinite",values:"2;3;3;2;2"})]})]}),d.jsxs("circle",{cx:22,cy:14,r:1,fill:"currentColor",fillOpacity:0,children:[d.jsx("animate",{fill:"freeze",attributeName:"fill-opacity",begin:"1s",dur:"0.4s",values:"0;1"}),d.jsx("animate",{attributeName:"r",begin:"2s",dur:"3s",keyTimes:"0;0.1;0.2;0.3;1",repeatCount:"indefinite",values:"1;2;2;1;1"})]})]})}function zn(r){return d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",viewBox:"0 0 24 24",...r,children:[d.jsx("path",{fill:"none",stroke:"currentColor",strokeDasharray:48,strokeDashoffset:48,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.25 14C5.14 17.45 8.27 20 12 20C16.42 20 20 16.42 20 12C20 7.58 16.42 4 12 4C9.61 4 7.47 5.05 6 6.71L4 9",children:d.jsx("animate",{fill:"freeze",attributeName:"stroke-dashoffset",dur:"0.6s",values:"48;0"})}),d.jsxs("g",{fill:"currentColor",children:[d.jsxs("path",{fillOpacity:0,d:"M3.25 10H3.89645C4.11917 10 4.23071 9.73071 4.07322 9.57322L3.42678 8.92678C3.26929 8.76929 3 8.88083 3 9.10355V9.75C3 9.88807 3.11193 10 3.25 10Z",children:[d.jsx("set",{attributeName:"fill-opacity",begin:"0.6s",to:1}),d.jsx("animate",{fill:"freeze",attributeName:"d",begin:"0.6s",dur:"0.2s",values:"M3.25 10H3.89645C4.11917 10 4.23071 9.73071 4.07322 9.57322L3.42678 8.92678C3.26929 8.76929 3 8.88083 3 9.10355V9.75C3 9.88807 3.11193 10 3.25 10Z;M3.5 10H7.79289C8.23835 10 8.46143 9.46143 8.14645 9.14645L3.85355 4.85355C3.53857 4.53857 3 4.76165 3 5.20711V9.5C3 9.77614 3.22386 10 3.5 10Z"})]}),d.jsx("circle",{cx:12,cy:12,r:0,children:d.jsx("animate",{fill:"freeze",attributeName:"r",begin:"0.8s",dur:"0.2s",values:"0;2"})})]})]})}const Un=(r,a,u,c)=>["KEY_FetchGoalsInfinity",r,a,u,c],Q=z(`
    fragment GoalResponseFr on goals @_unmask {
        id
        created_at
        deleted_at
        finished_at
        is_favorite
        title
        slogan
        description
        status
        difficulty
        goal_ritual {
            ritual_id
            ritual_type
            ritual_power
            ritual_interval
            created_at
        }
    }
`),Yn=async r=>{try{const{limit:a,serverSearchInput:u,offset:c}=r,f=await Y(),m=z(`
                query query_activeGoals(
                    $limit: Int!
                    $offset: Int!
                    $serverSearchInput: String!
                    $finishedAt: timestamptz!
                ) {
                    goals(
                        limit: $limit
                        offset: $offset
                        order_by: [{ finished_at: asc }, { title: asc }]
                        where: {
                            _and: [
                                { deleted_at: { _is_null: true } }
                                { status: { _eq: "active" } }
                                { _not: { goal_ritual: {} } }
                                { finished_at: { _gte: $finishedAt } }
                                {
                                    _or: [
                                        { title: { _ilike: $serverSearchInput } }
                                        { slogan: { _ilike: $serverSearchInput } }
                                        { description: { _ilike: $serverSearchInput } }
                                    ]
                                }
                            ]
                        }
                    ) {
                        ...GoalResponseFr
                    }
                }
            `,[Q]),b=await f.request(m,{limit:a,offset:c??0,serverSearchInput:`%${u}%`,finishedAt:qe(new Date).toISOString()});return oe.parse(b).goals}catch(a){return await W(a)}},Wn=async r=>{try{const{limit:a,serverSearchInput:u,offset:c}=r,f=await Y(),m=z(`
                query query_expiredGoals(
                    $limit: Int!
                    $offset: Int!
                    $serverSearchInput: String!
                    $finishedAt: timestamptz!
                ) {
                    goals(
                        limit: $limit
                        offset: $offset
                        order_by: [{ finished_at: asc }, { title: asc }]
                        where: {
                            _and: [
                                { deleted_at: { _is_null: true } }
                                { status: { _eq: "active" } }
                                { finished_at: { _lt: $finishedAt } }
                                {
                                    _or: [
                                        { title: { _ilike: $serverSearchInput } }
                                        { slogan: { _ilike: $serverSearchInput } }
                                        { description: { _ilike: $serverSearchInput } }
                                    ]
                                }
                            ]
                        }
                    ) {
                        ...GoalResponseFr
                    }
                }
            `,[Q]),b=await f.request(m,{limit:a,offset:c??0,serverSearchInput:`%${u}%`,finishedAt:qe(new Date).toISOString()});return oe.parse(b).goals}catch(a){return await W(a)}},Kn=async r=>{try{const{limit:a,serverSearchInput:u,offset:c}=r,f=await Y(),m=z(`
                query query_favoriteGoals($limit: Int!, $offset: Int!, $serverSearchInput: String!) {
                    goals(
                        limit: $limit
                        offset: $offset
                        order_by: [{ finished_at: asc }, { title: asc }]
                        where: {
                            _and: [
                                { deleted_at: { _is_null: true } }
                                { is_favorite: { _eq: true } }
                                {
                                    _or: [
                                        { title: { _ilike: $serverSearchInput } }
                                        { slogan: { _ilike: $serverSearchInput } }
                                        { description: { _ilike: $serverSearchInput } }
                                    ]
                                }
                            ]
                        }
                    ) {
                        ...GoalResponseFr
                    }
                }
            `,[Q]),b=await f.request(m,{serverSearchInput:`%${u}%`,limit:a,offset:c??0});return oe.parse(b).goals}catch(a){return await W(a)}},bt=async r=>{try{const{limit:a,offset:u,serverSearchInput:c,expiredGoals:f}=r,m=await Y(),b=z(`
                query query_ritualGoals(
                    $serverSearchInput: String!
                    $limit: Int!
                    $offset: Int
                    $finished_at: timestamptz_comparison_exp
                ) {
                    goals(
                        limit: $limit
                        offset: $offset
                        order_by: [{ finished_at: asc }, { title: asc }]
                        where: {
                            _and: [
                                { deleted_at: { _is_null: true } }
                                { status: { _eq: "active" } }
                                { goal_ritual: { ritual_power: { _gt: 0 } } }
                                { finished_at: $finished_at }
                                {
                                    _or: [
                                        { title: { _ilike: $serverSearchInput } }
                                        { slogan: { _ilike: $serverSearchInput } }
                                        { description: { _ilike: $serverSearchInput } }
                                    ]
                                }
                            ]
                        }
                    ) {
                        ...GoalResponseFr
                    }
                }
            `,[Q]),y=await m.request(b,{serverSearchInput:`%${c}%`,limit:a,offset:u,finished_at:f?{}:{_gte:qe(new Date).toISOString()}});return oe.parse(y).goals}catch(a){return await W(a)}},Vn=async r=>{try{const{limit:a,serverSearchInput:u,offset:c}=r,f=await Y(),m=z(`
                query query_deletedGoals($limit: Int!, $offset: Int!, $serverSearchInput: String!) {
                    goals(
                        limit: $limit
                        offset: $offset
                        order_by: [{ finished_at: asc }, { title: asc }]
                        where: {
                            _and: [
                                { deleted_at: { _is_null: false } }
                                {
                                    _or: [
                                        { title: { _ilike: $serverSearchInput } }
                                        { slogan: { _ilike: $serverSearchInput } }
                                        { description: { _ilike: $serverSearchInput } }
                                    ]
                                }
                            ]
                        }
                    ) {
                        ...GoalResponseFr
                    }
                }
            `,[Q]),b=await f.request(m,{limit:a,offset:c??0,serverSearchInput:`%${u}%`});return oe.parse(b).goals}catch(a){return await W(a)}},Hn=async r=>{try{const{limit:a,serverSearchInput:u,offset:c}=r,f=await Y(),m=z(`
                query query_completedGoals($limit: Int!, $offset: Int!, $serverSearchInput: String!) {
                    goals(
                        limit: $limit
                        offset: $offset
                        order_by: [{ finished_at: asc }, { title: asc }]
                        where: {
                            _and: [
                                { deleted_at: { _is_null: true } }
                                { status: { _eq: "completed" } }
                                {
                                    _or: [
                                        { title: { _ilike: $serverSearchInput } }
                                        { slogan: { _ilike: $serverSearchInput } }
                                        { description: { _ilike: $serverSearchInput } }
                                    ]
                                }
                            ]
                        }
                    ) {
                        ...GoalResponseFr
                    }
                }
            `,[Q]),b=await f.request(m,{limit:a,offset:c??0,serverSearchInput:`%${u}%`});return oe.parse(b).goals}catch(a){return await W(a)}},Qn=async r=>{try{const{limit:a,serverSearchInput:u,offset:c}=r,f=await Y(),m=z(`
                query query_allGoals($limit: Int!, $offset: Int!, $serverSearchInput: String!) {
                    goals(
                        limit: $limit
                        offset: $offset
                        order_by: [{ finished_at: asc }, { title: asc }]
                        where: {
                            _or: [
                                { title: { _ilike: $serverSearchInput } }
                                { slogan: { _ilike: $serverSearchInput } }
                                { description: { _ilike: $serverSearchInput } }
                            ]
                        }
                    ) {
                        ...GoalResponseFr
                    }
                }
            `,[Q]),b=await f.request(m,{limit:a,offset:c??0,serverSearchInput:`%${u}%`});return oe.parse(b).goals}catch(a){return await W(a)}},Ya=r=>{const{queryFilter:a=M.active,limit:u=20,serverSearchInput:c=""}=r,{id:f}=St(),{data:m,fetchNextPage:b,hasNextPage:y,isFetching:x,isFetchingNextPage:D}=qr({queryKey:Un(u,a,c,f),queryFn:async g=>{const w=g.pageParam,$=g.pageParam+5;let N=[];return a===M.all&&(N=await Qn({limit:u,offset:w,serverSearchInput:c})),a===M.favorite&&(N=await Kn({limit:u,offset:w,serverSearchInput:c})),a===M.active&&(N=await Yn({limit:u,offset:w,serverSearchInput:c})),a===M.expired&&(N=await Wn({limit:u,offset:w,serverSearchInput:c})),a===M.ritualActive&&(N=await bt({limit:u,offset:w,serverSearchInput:c,expiredGoals:!1})),a===M.ritual&&(N=await bt({limit:u,offset:w,serverSearchInput:c,expiredGoals:!0})),a===M.completed&&(N=await Hn({limit:u,offset:w,serverSearchInput:c})),a===M.deleted&&(N=await Vn({limit:u,offset:w,serverSearchInput:c})),{data:N,nextCursor:$}},initialPageParam:0,getNextPageParam:(g,w)=>{var $,N;return(N=($=Jr(w))==null?void 0:$.data)!=null&&N.length?g==null?void 0:g.nextCursor:void 0},staleTime:1e3,refetchOnWindowFocus:!1,refetchOnMount:!0,enabled:!!f}),L=zr(Zr(Ur(m==null?void 0:m.pages.map(g=>g.data))),(g,w)=>g.id===w.id);return{isLoading:x,fetchNextPage:b,isFetchingNextPage:D,hasNextPage:y,goals:L}},Xn=async r=>{try{const{goalId:a,isFavorite:u}=r,c=await Y(),f=z(`
                mutation mutation_updateGoalIsFavorite($goalId: uuid!, $isFavorite: Boolean!) {
                    update_goals_by_pk(pk_columns: { id: $goalId }, _set: { is_favorite: $isFavorite }) {
                        ...GoalResponseFr
                    }
                }
            `,[Q]),m=await c.request(f,{goalId:a,isFavorite:u});return we.parse(m.update_goals_by_pk)}catch(a){return await W(a)}},Jn=r=>["KEY_FetchGoal",r];le.object({goal_id:le.string().uuid(),ritual_id:le.string().uuid(),ritual_power:le.number(),created_at:le.string().nullable(),finished_at:le.string().nullable()});const xe=()=>{const r=Be();return{onSuccess:u=>{const c=u==null?void 0:u.id;r.invalidateQueries(),c&&r.invalidateQueries({queryKey:Jn(c)})}}},de=()=>{const r=Be(),{data:a}=Nt({queryKey:Me(),staleTime:1/0,refetchOnWindowFocus:!1,refetchOnMount:!1,initialData:{open:!1,goalId:null,goalEditorMode:null}}),u=y=>{r.setQueryData(Me(),y)},c=()=>{r.setQueryData(Me(),{open:!1,goalId:null,goalEditorMode:null})},f=a.goalEditorMode===q.view,m=a.goalEditorMode===q.new,b=a.goalEditorMode===q.edit;return{store:a,viewMode:f,newMode:m,editMode:b,setStore:u,onCancel:c,goalEditorMode:a.goalEditorMode}},Zn=()=>{const{onSuccess:r}=xe(),{store:a,editMode:u,setStore:c}=de(),f=fe({mutationFn:({goalId:b,isFavorite:y})=>Xn({goalId:b,isFavorite:y}),onSuccess:b=>{a.open&&u&&b&&c({goalId:b.id,open:!0,goalEditorMode:q.view}),r(b)}});return{toggleFavorite:b=>{const{goalId:y,isFavorite:x}=b;f.mutate({goalId:y,isFavorite:x})}}},ea=({goalId:r,isFavorite:a,label:u})=>{const{toggleFavorite:c}=Zn();return d.jsxs(d.Fragment,{children:[d.jsx(se,{id:"toggleFavoriteGoal",variant:a?"contained":"text",size:"small",onClick:()=>c({goalId:r,isFavorite:!a}),startIcon:d.jsx(fn,{className:_t("mb-0.5 h-6 w-6 opacity-70 hover:opacity-100")}),className:_t(a&&"!bg-pink-500"),children:u}),!u&&d.jsx(Se,{anchorSelect:"#toggleFavoriteGoal",children:a?"Unfavorite":"Favorite"})]})},ta=async r=>{try{const{goalId:a,deletedAt:u}=r,c=await Y(),f=z(`
                mutation mutation_updateGoalDeletedAt($goalId: uuid!, $deletedAt: timestamptz) {
                    update_goals_by_pk(pk_columns: { id: $goalId }, _set: { deleted_at: $deletedAt }) {
                        ...GoalResponseFr
                    }
                }
            `,[Q]),m=await c.request(f,{goalId:a,deletedAt:u});return we.parse(m==null?void 0:m.update_goals_by_pk)}catch(a){return await W(a)}},ra=()=>{const{onSuccess:r}=xe(),{store:a,editMode:u,setStore:c}=de(),f=fe({mutationFn:({goalId:b,deletedAt:y})=>ta({goalId:b,deletedAt:y}),onSuccess:b=>{a.open&&u&&b&&c({goalId:b.id,open:!0,goalEditorMode:q.view}),r(b)}});return{updateGoalDeletedAt:b=>{const{goalId:y,deletedAt:x}=b;f.mutate({goalId:y,deletedAt:x})}}},na=({goalId:r,deletedAt:a,label:u})=>{const{updateGoalDeletedAt:c}=ra();return d.jsxs(d.Fragment,{children:[d.jsx(se,{id:"toggleMoveGoalToBin",size:"small",error:!!a,variant:"text",onClick:()=>c({goalId:r,deletedAt:a?null:Oe()}),startIcon:d.jsx(Yr,{width:24,height:24,className:"h-6 w-6 opacity-70 hover:opacity-100"}),children:u}),!u&&d.jsx(Se,{anchorSelect:"#toggleMoveGoalToBin",children:a?"Restore":"Move to bin"})]})},aa=({label:r,goalId:a})=>{const{setStore:u,editMode:c,store:f}=de();return d.jsxs(d.Fragment,{children:[d.jsx(se,{id:"editGoal",variant:c?"contained":"text",size:"custom",startIcon:d.jsx(nn,{className:"h-6 w-6 opacity-70 hover:opacity-100"}),onClick:()=>{u({goalEditorMode:c?q.view:q.edit,open:!0,goalId:a,metadata:{viewModeRedirect:f.goalEditorMode===q.view?f.goalEditorMode:void 0}})},children:r}),!r&&d.jsx(Se,{anchorSelect:"#editGoal",children:c?"Cancel":"Edit"})]})},ia=({label:r,parentGoalId:a})=>{var b,y;const{setStore:u,store:c}=de(),f=(b=c.metadata)==null?void 0:b.parentGoalId,m=(y=c.metadata)==null?void 0:y.parentGoalEditorMode;return d.jsxs(d.Fragment,{children:[d.jsx(se,{id:"createChildGoal",size:"custom",variant:f?"contained":"text",onClick:()=>{u(f?{goalEditorMode:m||q.view,open:!0,goalId:f}:{goalEditorMode:q.new,open:!0,goalId:null,metadata:{parentGoalId:a,parentGoalEditorMode:c.goalEditorMode}})},startIcon:d.jsx(Wr,{className:"h-6 w-6 opacity-70 hover:opacity-100"}),children:r}),!r&&d.jsx(Se,{anchorSelect:"#createChildGoal",children:"Create child goal"})]})};function oa(r){return d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 36 36",...r,children:[d.jsx("circle",{cx:18,cy:18,r:18,fill:"currentColor"}),d.jsx("path",{fill:"#FFF",d:"M25.565 11.295c-2.116 0-4.195 1.322-5.799 2.712a21.08 21.08 0 0 1 1.147 1.364c.172.227.423.534.733.882c1.236-1.084 2.689-2.044 3.919-2.044c2.09 0 3.79 1.7 3.79 3.79s-1.7 3.79-3.79 3.79c-2.337 0-5.484-3.456-6.402-4.668c-.45-.596-4.521-5.826-8.729-5.826c-3.697 0-6.705 3.008-6.705 6.705s3.008 6.704 6.705 6.704c2.055 0 4.073-1.248 5.657-2.594a21.026 21.026 0 0 1-1.255-1.483a14.747 14.747 0 0 0-.624-.757c-1.204 1.032-2.594 1.919-3.778 1.919c-2.09 0-3.79-1.7-3.79-3.79s1.7-3.79 3.79-3.79c2.338 0 5.484 3.456 6.402 4.668c.45.596 4.521 5.826 8.729 5.826a6.711 6.711 0 0 0 6.704-6.704a6.71 6.71 0 0 0-6.704-6.704"})]})}const sa=r=>{const{new_ritual_interval:a,goal_finished_at:u,ritual_type:c,edit:f}=r,m=new Date,b=c===dt.interval_in_days,y=c===dt.days_of_week;let x=m,D=m;return u<=m?(x=m,b&&(D=ye(x,{days:a})),y&&(D=ye(x,{days:It(x,a)}))):(x=f?D:u,b&&(D=ye(x,{days:a})),y&&(D=ye(x,{days:It(x,a)}))),{ritual_goal_created_at:Ie(D,{hours:0,minutes:0,seconds:0,milliseconds:0}),ritual_goal_finished_at:Ie(D,{hours:23,minutes:59,seconds:59,milliseconds:59})}},It=(r,a)=>{let u=0;const c=vn(r);return c>a?u=7-c+a:c===a?u=7:u=a-c,u},Gt=async r=>{try{const{coins:a,userId:u}=r,c=await Y(),f=z(`
            mutation mutation_userCoins($coins: Int!, $userId: uuid!) {
                update_heroes_by_pk(pk_columns: { id: $userId }, _set: { coins: $coins }) {
                    id
                    role
                    coins
                    avatar
                    phone
                    email
                    birthday
                }
            }
        `),m=await c.request(f,{coins:a,userId:u});return xt.parse(m==null?void 0:m.update_heroes_by_pk)}catch(a){return await W(a)}},ua=(r,a)=>{const{difficulty:u,goal_ritual:c}=r;if(c){const f=c.ritual_power||0;return f<=10?a+10+1*f:f<=30?a+20+1*f:f<=60?a+30+1*f:f<=100?a+50+1*f:f<=365?a+100+10*f:f<=731?a+1e3+100*f:f<=1097?a+1e4+1e3*f:f<=1464?a+1e5+1e4*f:f<=1829?a+1e6+1e5*f:f>1829?a+1e9+1e7*f:10+a}else switch(u){case ae.LIGHT:return a+200;case ae.MEDIUM:return a+1e3;case ae.LEGEND:return a+1e4;case ae.EPIC:return a+1e5;case ae.STAR:return a+1e6;case ae.FRIEND_OF_DEATH:return a+1e7;case ae.IMMORTAL:return a+1e9;default:return a}},ca=(r,a)=>r<=10?a+10+r:r<=30?a+20+r:r<=60?a+30+r:r<=100?a+40+r:r<=365?a+50+r:r<=731?a+100+r:r<=1097?a+150+r:r<=1464?a+250+r:r<=1829?a+500+r:r>1829?a+1e3+r:10+a,Mt=r=>["KEY_FetchUserDetails",r],la=async r=>{try{const{userId:a}=r,u=await Y(),c=z(`
            query query_userDetails($userId: uuid!) {
                heroes_by_pk(id: $userId) {
                    id
                    role
                    coins
                    avatar
                    phone
                    email
                    birthday
                }
                goals(
                    where: {
                        owner_id: { _eq: $userId }
                        deleted_at: { _is_null: true }
                        status: { _eq: "active" }
                        goal_ritual: { ritual_power: { _gt: 0 } }
                    }
                ) {
                    goal_ritual {
                        ritual_power
                    }
                }
            }
        `);return await u.request(c,{userId:a}).then(f=>{const m=xt.parse(f.heroes_by_pk),b=f==null?void 0:f.goals.filter(y=>y.goal_ritual).reduce((y,x)=>{var D;return y+=Number((D=x.goal_ritual)==null?void 0:D.ritual_power)},0);return{user:m,ritualPower:b}})}catch(a){return await W(a)}},fa=r=>{var c;const{data:a,isLoading:u}=Nt({queryKey:Mt(r.userId),queryFn:async()=>await la({userId:r.userId}),staleTime:1/0,refetchOnWindowFocus:!1,refetchOnMount:!1,enabled:!!r.userId});return{isLoading:u,user:a==null?void 0:a.user,ritualPower:(a==null?void 0:a.ritualPower)||0,coins:((c=a==null?void 0:a.user)==null?void 0:c.coins)||0}},kt=()=>{const{id:r}=St(),{coins:a}=fa({userId:r});return{recalculateUserCoins:c=>{var m;const f=c.goal.status===M.active;return c.status===M.ritual?f?ca(((m=c.goal.goal_ritual)==null?void 0:m.ritual_power)||0,a):a+5:f?ua(c.goal,a):a+5},userId:r}},Ot=()=>{const r=Be();return{onSuccess:u=>{const c=u==null?void 0:u.id;c&&r.invalidateQueries({queryKey:Mt(c)})}}},da=async({goalRitual:r})=>{try{const a=await Y(),u=z(`
                mutation mutation_ritualizeGoal(
                    $goalId: uuid!
                    $status: String!
                    $createdAt: timestamptz
                    $finishedAt: timestamptz
                    $ritualId: uuid!
                    $ritualPower: Int!
                ) {
                    update_goals_by_pk(
                        pk_columns: { id: $goalId }
                        _set: { status: $status, created_at: $createdAt, finished_at: $finishedAt }
                    ) {
                        ...GoalResponseFr
                    }

                    update_goals_rituals_by_pk(
                        pk_columns: { goal_id: $goalId, ritual_id: $ritualId }
                        _set: { ritual_power: $ritualPower }
                    ) {
                        goal_id
                    }
                }
            `,[Q]),c=await a.request(u,{goalId:r.goal_id,status:M.active,createdAt:r.created_at,finishedAt:r.finished_at,ritualId:r.ritual_id,ritualPower:r.ritual_power});return we.parse(c.update_goals_by_pk)}catch(a){return await W(a)}},ha=()=>{const{recalculateUserCoins:r,userId:a}=kt(),{onSuccess:u}=Ot(),{onSuccess:c}=xe(),f=fe({mutationFn:({goalRitual:y})=>da({goalRitual:y}),onSuccess:c}),m=fe({mutationFn:({coins:y})=>Gt({coins:y,userId:a}),onSuccess:u});return{ritualizeGoal:y=>{var w,$,N,B;const{goal:x}=y;if(!x.goal_ritual||!x.finished_at)return;const{ritual_goal_created_at:D,ritual_goal_finished_at:L}=sa({ritual_type:(w=x.goal_ritual)==null?void 0:w.ritual_type,new_ritual_interval:($=x.goal_ritual)==null?void 0:$.ritual_interval,goal_finished_at:new Date(x.finished_at)}),g={goal_id:x.id,ritual_id:(N=x.goal_ritual)==null?void 0:N.ritual_id,ritual_power:(((B=x.goal_ritual)==null?void 0:B.ritual_power)||0)+10,created_at:Oe(D),finished_at:Oe(L)};m.mutate({coins:r({goal:x,status:M.ritual})}),f.mutate({goalRitual:g},{onSuccess:y.onSuccess,onSettled:y.onSettled})}}},ze=r=>r===M.completed,va=r=>r===M.active,Wa=r=>r===M.expired,Lt=r=>va(r.status)&&!!r.goal_ritual,Ka=r=>r===M.ritual||r===M.ritualActive,Ue=r=>!!r.finished_at&&en(Rt(r.finished_at))<new Date(Date.now()),Pt=r=>!!r.goal_ritual,Va=r=>{var a;return!!((a=r.goal_ritual)!=null&&a.ritual_power)},ma=r=>!r.created_at||!r.finished_at?!1:!!_n(Ie(r.finished_at,{hours:0,minutes:0,seconds:0})),Ha=r=>{var m,b;if(!r.created_at)return 0;const a=(m=r==null?void 0:r.goal_ritual)!=null&&m.created_at?(b=r==null?void 0:r.goal_ritual)==null?void 0:b.created_at:r.created_at,u=Date.now(),c=Rt(a).getTime(),f=new Date(u-c);return Math.floor(f.getTime()/(1e3*3600*24))},Bt=r=>r.finished_at?mn(r.finished_at,Ie(new Date,{hours:0,minutes:0,seconds:0})):NaN,_a=r=>Ue(r)?!0:Bt(r)<1,pa=({goal:r,onClose:a})=>{const{ritualizeGoal:u}=ha(),c=ma(r),f=!!r.deleted_at;return Lt(r)&&!c&&!f?d.jsx(d.Fragment,{children:d.jsx(ie,{children:d.jsx(se,{variant:"contained",size:"small",onClick:()=>{u({goal:r,onSuccess:()=>{Et("Goal ritualized")},onSettled:a})},startIcon:d.jsx(oa,{className:"mb-0.5 h-6 w-6 opacity-100 text-teal-500 hover:opacity-100"}),className:"!bg-teal-500",children:d.jsx("span",{className:"w-[120px] flex justify-start",children:d.jsx("span",{children:"Ritualize"})})})})}):null},ga=async r=>{try{const{goal:a,status:u}=r,c=await Y(),f=z(`
                mutation mutation_goalStatus($goalId: uuid!, $status: String!) {
                    update_goals_by_pk(pk_columns: { id: $goalId }, _set: { status: $status }) {
                        ...GoalResponseFr
                    }
                }
            `,[Q]),m=await c.request(f,{goalId:a.id,status:u});return we.parse(m.update_goals_by_pk)}catch(a){return await W(a)}},ya=()=>{const{recalculateUserCoins:r,userId:a}=kt(),{onSuccess:u}=Ot(),{onSuccess:c}=xe(),f=fe({mutationFn:({goal:y,status:x})=>ga({goal:y,status:x}),onSuccess:c}),m=fe({mutationFn:({coins:y})=>Gt({coins:y,userId:a}),onSuccess:u});return{updateGoalStatus:y=>{f.mutate({goal:y.goal,status:y.status}),M.completed&&m.mutate({coins:r({goal:y.goal})},{onSuccess:y.onSuccess,onSettled:y.onSettled})}}},ba=({goal:r,onClose:a})=>{const{updateGoalStatus:u}=ya();return Lt(r)||ze(r.status)?null:d.jsx(d.Fragment,{children:d.jsx(ie,{children:d.jsx(se,{variant:"contained",size:"small",onClick:()=>{u({goal:r,status:M.completed,onSuccess:()=>{Et("Goal completed")},onSettled:a})},startIcon:d.jsx(hn,{className:"mb-0.5 h-6 w-6 opacity-100 hover:opacity-100"}),children:d.jsx("span",{className:"w-[120px] flex justify-start ",children:d.jsx("span",{children:"Complete"})})})})})},Ia=({goal:r,action:a})=>{const{setStore:u}=de();return d.jsxs(an,{children:[d.jsx(ba,{goal:r,onClose:a}),d.jsx(pa,{goal:r,onClose:a}),d.jsx(ie,{children:d.jsx(ea,{goalId:r.id,isFavorite:!!r.is_favorite,label:d.jsx("span",{className:"flex w-[120px] justify-start capitalize",children:r.is_favorite?"Unfavorite":"Favorite"})})}),d.jsx(ie,{onClick:()=>{u({goalEditorMode:q.view,goalId:r.id,open:!0}),a()},children:d.jsx(se,{variant:"text",size:"small",startIcon:d.jsx(ln,{width:24,height:24}),children:d.jsx("span",{className:"flex w-[110px] justify-start capitalize",children:"open"})})}),d.jsx(ie,{onClick:()=>{u({goalEditorMode:q.edit,goalId:r.id,open:!0}),a()},children:d.jsx(aa,{goalId:r.id,label:d.jsx("span",{className:"flex w-[110px] justify-start capitalize",children:"edit"})})}),d.jsx(ie,{onClick:a,children:d.jsx(na,{goalId:r.id,deletedAt:!!r.deleted_at,label:d.jsx("span",{className:"flex w-[110px] justify-start capitalize",children:r.deleted_at?"Restore":"Move to bin"})})}),d.jsx(on,{}),d.jsx(ie,{onClick:()=>{u({goalEditorMode:q.new,metadata:{parentGoalId:r.id},open:!0,goalId:null}),a()},children:d.jsx(ia,{parentGoalId:r.id,label:d.jsx("span",{className:"flex w-[120px] justify-start capitalize",children:"New child goal"})})})]})},wa=r=>{let a="bg-blue-700 hover:bg-blue-600";const u=Pt(r),c=Ue(r),f=r.is_favorite,m=ze(r.status),b=!!r.deleted_at;return f?a=re("bg-gradient-to-r from-blue-600 via-blue-500 to-rose-500 shadow-[0_2px_50px_rgba(8,_112,_184,_0.7)]"):m?a=re("bg-violet-700 hover:bg-violet-600"):c?a="bg-amber-600 hover:bg-amber-500":u&&(a=re("bg-emerald-700 hover:bg-emerald-600")),f&&u&&(a=re("bg-gradient-to-r from-emerald-600 via-emerald-500 to-rose-500 shadow-[0_2px_50px_rgba(8,_212,_184,_0.7)]")),f&&c&&(a=re("bg-gradient-to-r from-amber-600 via-amber-500 to-rose-500 shadow-[0_2px_25px_rgba(255,_193,_71,_0.7)]")),f&&m&&(a=re("bg-gradient-to-r from-violet-700 via-violet-600 to-rose-500 shadow-[0_2px_25px_rgba(238,_130,_238,_0.7)]")),b&&(a=re("bg-slate-700 hover:bg-slate-600")),f&&b&&(a=re("bg-gradient-to-r from-slate-700 via-slate-600 to-rose-500 shadow-[0_2px_25px_rgba(112,_128,_211,_0.7)]")),{containerClass:a}},Sa=({goal:r})=>{const a=Ue(r),u=_a(r),c=ze(r.status),f=Bt(r);return d.jsx("span",{"data-testid":"topGoal__remainingDays",className:"flex w-12 items-center justify-center px-1",children:a||c?d.jsx("div",{className:"opacity-40",children:Pt(r)?d.jsx(zn,{width:24,height:24}):d.jsx(sn,{width:24,height:24})}):u?d.jsx(qn,{width:30,height:30,className:"text-white"}):d.jsx("span",{className:"text-xl text-white opacity-70",children:f<9999?f:"9999+"})})},xa=({title:r})=>d.jsx("span",{"data-testid":"topGoal__title",className:"h-fit w-[calc(100%-16px)] items-center  rounded-md p-2 align-middle text-white",children:Bn(r,{length:65})}),Ea=({goal:r,className:a="",selectGoal:u,onRightClick:c})=>{const f=wa(r).containerClass;return d.jsxs("div",{"data-testid":"topGoal__body",onClick:m=>{m.preventDefault(),m.stopPropagation(),u()},onContextMenu:c,className:`relative hover:scale-105 duration-300 flex h-[60px] cursor-pointer items-center justify-between rounded-lg  ${f} ${a} `,children:[d.jsx(xa,{title:r.title}),d.jsx(Sa,{goal:r})]},r.id)},Qa=({goal:r,className:a="",zIndex:u})=>{const{setStore:c}=de(),{popoverState:f,setPopoverState:m}=un();return d.jsx(cn,{open:f,onOpenChange:()=>{m(!f)},overlayStyle:{zIndex:u},trigger:["click","contextMenu"],dropdownRender:()=>d.jsx(Ia,{action:()=>m(!1),goal:r}),children:d.jsx("div",{children:d.jsx(Ea,{goal:r,selectGoal:()=>{c({goalEditorMode:q.view,goalId:r.id,open:!0}),m(!1)},onRightClick:()=>{m(!f)},className:a})})})};function be(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ke={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/var wt;function Ra(){return wt||(wt=1,function(r,a){(function(u){r.exports=u()})(function(){return function u(c,f,m){function b(D,L){if(!f[D]){if(!c[D]){var g=typeof be=="function"&&be;if(!L&&g)return g(D,!0);if(y)return y(D,!0);var w=new Error("Cannot find module '"+D+"'");throw w.code="MODULE_NOT_FOUND",w}var $=f[D]={exports:{}};c[D][0].call($.exports,function(N){var B=c[D][1][N];return b(B||N)},$,$.exports,u,c,f,m)}return f[D].exports}for(var y=typeof be=="function"&&be,x=0;x<m.length;x++)b(m[x]);return b}({1:[function(u,c,f){(function(m){var b=m.MutationObserver||m.WebKitMutationObserver,y;if(b){var x=0,D=new b(N),L=m.document.createTextNode("");D.observe(L,{characterData:!0}),y=function(){L.data=x=++x%2}}else if(!m.setImmediate&&typeof m.MessageChannel<"u"){var g=new m.MessageChannel;g.port1.onmessage=N,y=function(){g.port2.postMessage(0)}}else"document"in m&&"onreadystatechange"in m.document.createElement("script")?y=function(){var k=m.document.createElement("script");k.onreadystatechange=function(){N(),k.onreadystatechange=null,k.parentNode.removeChild(k),k=null},m.document.documentElement.appendChild(k)}:y=function(){setTimeout(N,0)};var w,$=[];function N(){w=!0;for(var k,X,O=$.length;O;){for(X=$,$=[],k=-1;++k<O;)X[k]();O=$.length}w=!1}c.exports=B;function B(k){$.push(k)===1&&!w&&y()}}).call(this,typeof window<"u"?window:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(u,c,f){var m=u(1);function b(){}var y={},x=["REJECTED"],D=["FULFILLED"],L=["PENDING"];c.exports=g;function g(I){if(typeof I!="function")throw new TypeError("resolver must be a function");this.state=L,this.queue=[],this.outcome=void 0,I!==b&&B(this,I)}g.prototype.catch=function(I){return this.then(null,I)},g.prototype.then=function(I,A){if(typeof I!="function"&&this.state===D||typeof A!="function"&&this.state===x)return this;var R=new this.constructor(b);if(this.state!==L){var F=this.state===D?I:A;$(R,F,this.outcome)}else this.queue.push(new w(R,I,A));return R};function w(I,A,R){this.promise=I,typeof A=="function"&&(this.onFulfilled=A,this.callFulfilled=this.otherCallFulfilled),typeof R=="function"&&(this.onRejected=R,this.callRejected=this.otherCallRejected)}w.prototype.callFulfilled=function(I){y.resolve(this.promise,I)},w.prototype.otherCallFulfilled=function(I){$(this.promise,this.onFulfilled,I)},w.prototype.callRejected=function(I){y.reject(this.promise,I)},w.prototype.otherCallRejected=function(I){$(this.promise,this.onRejected,I)};function $(I,A,R){m(function(){var F;try{F=A(R)}catch(P){return y.reject(I,P)}F===I?y.reject(I,new TypeError("Cannot resolve promise with itself")):y.resolve(I,F)})}y.resolve=function(I,A){var R=k(N,A);if(R.status==="error")return y.reject(I,R.value);var F=R.value;if(F)B(I,F);else{I.state=D,I.outcome=A;for(var P=-1,U=I.queue.length;++P<U;)I.queue[P].callFulfilled(A)}return I},y.reject=function(I,A){I.state=x,I.outcome=A;for(var R=-1,F=I.queue.length;++R<F;)I.queue[R].callRejected(A);return I};function N(I){var A=I&&I.then;if(I&&(typeof I=="object"||typeof I=="function")&&typeof A=="function")return function(){A.apply(I,arguments)}}function B(I,A){var R=!1;function F(V){R||(R=!0,y.reject(I,V))}function P(V){R||(R=!0,y.resolve(I,V))}function U(){A(P,F)}var K=k(U);K.status==="error"&&F(K.value)}function k(I,A){var R={};try{R.value=I(A),R.status="success"}catch(F){R.status="error",R.value=F}return R}g.resolve=X;function X(I){return I instanceof this?I:y.resolve(new this(b),I)}g.reject=O;function O(I){var A=new this(b);return y.reject(A,I)}g.all=Ee;function Ee(I){var A=this;if(Object.prototype.toString.call(I)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=I.length,F=!1;if(!R)return this.resolve([]);for(var P=new Array(R),U=0,K=-1,V=new this(b);++K<R;)J(I[K],K);return V;function J(he,_e){A.resolve(he).then(Re,function(ue){F||(F=!0,y.reject(V,ue))});function Re(ue){P[_e]=ue,++U===R&&!F&&(F=!0,y.resolve(V,P))}}}g.race=ne;function ne(I){var A=this;if(Object.prototype.toString.call(I)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=I.length,F=!1;if(!R)return this.resolve([]);for(var P=-1,U=new this(b);++P<R;)K(I[P]);return U;function K(V){A.resolve(V).then(function(J){F||(F=!0,y.resolve(U,J))},function(J){F||(F=!0,y.reject(U,J))})}}},{1:1}],3:[function(u,c,f){(function(m){typeof m.Promise!="function"&&(m.Promise=u(2))}).call(this,typeof window<"u"?window:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(u,c,f){var m=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function b(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function y(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var x=y();function D(){try{if(!x||!x.open)return!1;var e=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),n=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!e||n)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function L(e,n){e=e||[],n=n||{};try{return new Blob(e,n)}catch(i){if(i.name!=="TypeError")throw i;for(var t=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,o=new t,s=0;s<e.length;s+=1)o.append(e[s]);return o.getBlob(n.type)}}typeof Promise>"u"&&u(3);var g=Promise;function w(e,n){n&&e.then(function(t){n(null,t)},function(t){n(t)})}function $(e,n,t){typeof n=="function"&&e.then(n),typeof t=="function"&&e.catch(t)}function N(e){return typeof e!="string"&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function B(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var k="local-forage-detect-blob-support",X=void 0,O={},Ee=Object.prototype.toString,ne="readonly",I="readwrite";function A(e){for(var n=e.length,t=new ArrayBuffer(n),o=new Uint8Array(t),s=0;s<n;s++)o[s]=e.charCodeAt(s);return t}function R(e){return new g(function(n){var t=e.transaction(k,I),o=L([""]);t.objectStore(k).put(o,"key"),t.onabort=function(s){s.preventDefault(),s.stopPropagation(),n(!1)},t.oncomplete=function(){var s=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);n(i||!s||parseInt(s[1],10)>=43)}}).catch(function(){return!1})}function F(e){return typeof X=="boolean"?g.resolve(X):R(e).then(function(n){return X=n,X})}function P(e){var n=O[e.name],t={};t.promise=new g(function(o,s){t.resolve=o,t.reject=s}),n.deferredOperations.push(t),n.dbReady?n.dbReady=n.dbReady.then(function(){return t.promise}):n.dbReady=t.promise}function U(e){var n=O[e.name],t=n.deferredOperations.pop();if(t)return t.resolve(),t.promise}function K(e,n){var t=O[e.name],o=t.deferredOperations.pop();if(o)return o.reject(n),o.promise}function V(e,n){return new g(function(t,o){if(O[e.name]=O[e.name]||We(),e.db)if(n)P(e),e.db.close();else return t(e.db);var s=[e.name];n&&s.push(e.version);var i=x.open.apply(x,s);n&&(i.onupgradeneeded=function(l){var h=i.result;try{h.createObjectStore(e.storeName),l.oldVersion<=1&&h.createObjectStore(k)}catch(v){if(v.name==="ConstraintError")console.warn('The database "'+e.name+'" has been upgraded from version '+l.oldVersion+" to version "+l.newVersion+', but the storage "'+e.storeName+'" already exists.');else throw v}}),i.onerror=function(l){l.preventDefault(),o(i.error)},i.onsuccess=function(){var l=i.result;l.onversionchange=function(h){h.target.close()},t(l),U(e)}})}function J(e){return V(e,!1)}function he(e){return V(e,!0)}function _e(e,n){if(!e.db)return!0;var t=!e.db.objectStoreNames.contains(e.storeName),o=e.version<e.db.version,s=e.version>e.db.version;if(o&&(e.version!==n&&console.warn('The database "'+e.name+`" can't be downgraded from version `+e.db.version+" to version "+e.version+"."),e.version=e.db.version),s||t){if(t){var i=e.db.version+1;i>e.version&&(e.version=i)}return!0}return!1}function Re(e){return new g(function(n,t){var o=new FileReader;o.onerror=t,o.onloadend=function(s){var i=btoa(s.target.result||"");n({__local_forage_encoded_blob:!0,data:i,type:e.type})},o.readAsBinaryString(e)})}function ue(e){var n=A(atob(e.data));return L([n],{type:e.type})}function Ye(e){return e&&e.__local_forage_encoded_blob}function zt(e){var n=this,t=n._initReady().then(function(){var o=O[n._dbInfo.name];if(o&&o.dbReady)return o.dbReady});return $(t,e,e),t}function Ut(e){P(e);for(var n=O[e.name],t=n.forages,o=0;o<t.length;o++){var s=t[o];s._dbInfo.db&&(s._dbInfo.db.close(),s._dbInfo.db=null)}return e.db=null,J(e).then(function(i){return e.db=i,_e(e)?he(e):i}).then(function(i){e.db=n.db=i;for(var l=0;l<t.length;l++)t[l]._dbInfo.db=i}).catch(function(i){throw K(e,i),i})}function Z(e,n,t,o){o===void 0&&(o=1);try{var s=e.db.transaction(e.storeName,n);t(null,s)}catch(i){if(o>0&&(!e.db||i.name==="InvalidStateError"||i.name==="NotFoundError"))return g.resolve().then(function(){if(!e.db||i.name==="NotFoundError"&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),he(e)}).then(function(){return Ut(e).then(function(){Z(e,n,t,o-1)})}).catch(t);t(i)}}function We(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Yt(e){var n=this,t={db:null};if(e)for(var o in e)t[o]=e[o];var s=O[t.name];s||(s=We(),O[t.name]=s),s.forages.push(n),n._initReady||(n._initReady=n.ready,n.ready=zt);var i=[];function l(){return g.resolve()}for(var h=0;h<s.forages.length;h++){var v=s.forages[h];v!==n&&i.push(v._initReady().catch(l))}var _=s.forages.slice(0);return g.all(i).then(function(){return t.db=s.db,J(t)}).then(function(p){return t.db=p,_e(t,n._defaultConfig.version)?he(t):p}).then(function(p){t.db=s.db=p,n._dbInfo=t;for(var S=0;S<_.length;S++){var E=_[S];E!==n&&(E._dbInfo.db=t.db,E._dbInfo.version=t.version)}})}function Wt(e,n){var t=this;e=N(e);var o=new g(function(s,i){t.ready().then(function(){Z(t._dbInfo,ne,function(l,h){if(l)return i(l);try{var v=h.objectStore(t._dbInfo.storeName),_=v.get(e);_.onsuccess=function(){var p=_.result;p===void 0&&(p=null),Ye(p)&&(p=ue(p)),s(p)},_.onerror=function(){i(_.error)}}catch(p){i(p)}})}).catch(i)});return w(o,n),o}function Kt(e,n){var t=this,o=new g(function(s,i){t.ready().then(function(){Z(t._dbInfo,ne,function(l,h){if(l)return i(l);try{var v=h.objectStore(t._dbInfo.storeName),_=v.openCursor(),p=1;_.onsuccess=function(){var S=_.result;if(S){var E=S.value;Ye(E)&&(E=ue(E));var T=e(E,S.key,p++);T!==void 0?s(T):S.continue()}else s()},_.onerror=function(){i(_.error)}}catch(S){i(S)}})}).catch(i)});return w(o,n),o}function Vt(e,n,t){var o=this;e=N(e);var s=new g(function(i,l){var h;o.ready().then(function(){return h=o._dbInfo,Ee.call(n)==="[object Blob]"?F(h.db).then(function(v){return v?n:Re(n)}):n}).then(function(v){Z(o._dbInfo,I,function(_,p){if(_)return l(_);try{var S=p.objectStore(o._dbInfo.storeName);v===null&&(v=void 0);var E=S.put(v,e);p.oncomplete=function(){v===void 0&&(v=null),i(v)},p.onabort=p.onerror=function(){var T=E.error?E.error:E.transaction.error;l(T)}}catch(T){l(T)}})}).catch(l)});return w(s,t),s}function Ht(e,n){var t=this;e=N(e);var o=new g(function(s,i){t.ready().then(function(){Z(t._dbInfo,I,function(l,h){if(l)return i(l);try{var v=h.objectStore(t._dbInfo.storeName),_=v.delete(e);h.oncomplete=function(){s()},h.onerror=function(){i(_.error)},h.onabort=function(){var p=_.error?_.error:_.transaction.error;i(p)}}catch(p){i(p)}})}).catch(i)});return w(o,n),o}function Qt(e){var n=this,t=new g(function(o,s){n.ready().then(function(){Z(n._dbInfo,I,function(i,l){if(i)return s(i);try{var h=l.objectStore(n._dbInfo.storeName),v=h.clear();l.oncomplete=function(){o()},l.onabort=l.onerror=function(){var _=v.error?v.error:v.transaction.error;s(_)}}catch(_){s(_)}})}).catch(s)});return w(t,e),t}function Xt(e){var n=this,t=new g(function(o,s){n.ready().then(function(){Z(n._dbInfo,ne,function(i,l){if(i)return s(i);try{var h=l.objectStore(n._dbInfo.storeName),v=h.count();v.onsuccess=function(){o(v.result)},v.onerror=function(){s(v.error)}}catch(_){s(_)}})}).catch(s)});return w(t,e),t}function Jt(e,n){var t=this,o=new g(function(s,i){if(e<0){s(null);return}t.ready().then(function(){Z(t._dbInfo,ne,function(l,h){if(l)return i(l);try{var v=h.objectStore(t._dbInfo.storeName),_=!1,p=v.openKeyCursor();p.onsuccess=function(){var S=p.result;if(!S){s(null);return}e===0||_?s(S.key):(_=!0,S.advance(e))},p.onerror=function(){i(p.error)}}catch(S){i(S)}})}).catch(i)});return w(o,n),o}function Zt(e){var n=this,t=new g(function(o,s){n.ready().then(function(){Z(n._dbInfo,ne,function(i,l){if(i)return s(i);try{var h=l.objectStore(n._dbInfo.storeName),v=h.openKeyCursor(),_=[];v.onsuccess=function(){var p=v.result;if(!p){o(_);return}_.push(p.key),p.continue()},v.onerror=function(){s(v.error)}}catch(p){s(p)}})}).catch(s)});return w(t,e),t}function er(e,n){n=B.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var o=this,s;if(!e.name)s=g.reject("Invalid arguments");else{var i=e.name===t.name&&o._dbInfo.db,l=i?g.resolve(o._dbInfo.db):J(e).then(function(h){var v=O[e.name],_=v.forages;v.db=h;for(var p=0;p<_.length;p++)_[p]._dbInfo.db=h;return h});e.storeName?s=l.then(function(h){if(h.objectStoreNames.contains(e.storeName)){var v=h.version+1;P(e);var _=O[e.name],p=_.forages;h.close();for(var S=0;S<p.length;S++){var E=p[S];E._dbInfo.db=null,E._dbInfo.version=v}var T=new g(function(C,G){var j=x.open(e.name,v);j.onerror=function(H){var me=j.result;me.close(),G(H)},j.onupgradeneeded=function(){var H=j.result;H.deleteObjectStore(e.storeName)},j.onsuccess=function(){var H=j.result;H.close(),C(H)}});return T.then(function(C){_.db=C;for(var G=0;G<p.length;G++){var j=p[G];j._dbInfo.db=C,U(j._dbInfo)}}).catch(function(C){throw(K(e,C)||g.resolve()).catch(function(){}),C})}}):s=l.then(function(h){P(e);var v=O[e.name],_=v.forages;h.close();for(var p=0;p<_.length;p++){var S=_[p];S._dbInfo.db=null}var E=new g(function(T,C){var G=x.deleteDatabase(e.name);G.onerror=function(){var j=G.result;j&&j.close(),C(G.error)},G.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},G.onsuccess=function(){var j=G.result;j&&j.close(),T(j)}});return E.then(function(T){v.db=T;for(var C=0;C<_.length;C++){var G=_[C];U(G._dbInfo)}}).catch(function(T){throw(K(e,T)||g.resolve()).catch(function(){}),T})})}return w(s,n),s}var tr={_driver:"asyncStorage",_initStorage:Yt,_support:D(),iterate:Kt,getItem:Wt,setItem:Vt,removeItem:Ht,clear:Qt,length:Xt,key:Jt,keys:Zt,dropInstance:er};function rr(){return typeof openDatabase=="function"}var ee="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",nr="~~local_forage_type~",Ke=/^~~local_forage_type~([^~]+)~/,pe="__lfsc__:",De=pe.length,Ne="arbf",Ae="blob",Ve="si08",He="ui08",Qe="uic8",Xe="si16",Je="si32",Ze="ur16",et="ui32",tt="fl32",rt="fl64",nt=De+Ne.length,at=Object.prototype.toString;function it(e){var n=e.length*.75,t=e.length,o,s=0,i,l,h,v;e[e.length-1]==="="&&(n--,e[e.length-2]==="="&&n--);var _=new ArrayBuffer(n),p=new Uint8Array(_);for(o=0;o<t;o+=4)i=ee.indexOf(e[o]),l=ee.indexOf(e[o+1]),h=ee.indexOf(e[o+2]),v=ee.indexOf(e[o+3]),p[s++]=i<<2|l>>4,p[s++]=(l&15)<<4|h>>2,p[s++]=(h&3)<<6|v&63;return _}function Te(e){var n=new Uint8Array(e),t="",o;for(o=0;o<n.length;o+=3)t+=ee[n[o]>>2],t+=ee[(n[o]&3)<<4|n[o+1]>>4],t+=ee[(n[o+1]&15)<<2|n[o+2]>>6],t+=ee[n[o+2]&63];return n.length%3===2?t=t.substring(0,t.length-1)+"=":n.length%3===1&&(t=t.substring(0,t.length-2)+"=="),t}function ar(e,n){var t="";if(e&&(t=at.call(e)),e&&(t==="[object ArrayBuffer]"||e.buffer&&at.call(e.buffer)==="[object ArrayBuffer]")){var o,s=pe;e instanceof ArrayBuffer?(o=e,s+=Ne):(o=e.buffer,t==="[object Int8Array]"?s+=Ve:t==="[object Uint8Array]"?s+=He:t==="[object Uint8ClampedArray]"?s+=Qe:t==="[object Int16Array]"?s+=Xe:t==="[object Uint16Array]"?s+=Ze:t==="[object Int32Array]"?s+=Je:t==="[object Uint32Array]"?s+=et:t==="[object Float32Array]"?s+=tt:t==="[object Float64Array]"?s+=rt:n(new Error("Failed to get type for BinaryArray"))),n(s+Te(o))}else if(t==="[object Blob]"){var i=new FileReader;i.onload=function(){var l=nr+e.type+"~"+Te(this.result);n(pe+Ae+l)},i.readAsArrayBuffer(e)}else try{n(JSON.stringify(e))}catch(l){console.error("Couldn't convert value into a JSON string: ",e),n(null,l)}}function ir(e){if(e.substring(0,De)!==pe)return JSON.parse(e);var n=e.substring(nt),t=e.substring(De,nt),o;if(t===Ae&&Ke.test(n)){var s=n.match(Ke);o=s[1],n=n.substring(s[0].length)}var i=it(n);switch(t){case Ne:return i;case Ae:return L([i],{type:o});case Ve:return new Int8Array(i);case He:return new Uint8Array(i);case Qe:return new Uint8ClampedArray(i);case Xe:return new Int16Array(i);case Ze:return new Uint16Array(i);case Je:return new Int32Array(i);case et:return new Uint32Array(i);case tt:return new Float32Array(i);case rt:return new Float64Array(i);default:throw new Error("Unkown type: "+t)}}var Ce={serialize:ar,deserialize:ir,stringToBuffer:it,bufferToString:Te};function ot(e,n,t,o){e.executeSql("CREATE TABLE IF NOT EXISTS "+n.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],t,o)}function or(e){var n=this,t={db:null};if(e)for(var o in e)t[o]=typeof e[o]!="string"?e[o].toString():e[o];var s=new g(function(i,l){try{t.db=openDatabase(t.name,String(t.version),t.description,t.size)}catch(h){return l(h)}t.db.transaction(function(h){ot(h,t,function(){n._dbInfo=t,i()},function(v,_){l(_)})},l)});return t.serializer=Ce,s}function te(e,n,t,o,s,i){e.executeSql(t,o,s,function(l,h){h.code===h.SYNTAX_ERR?l.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[n.storeName],function(v,_){_.rows.length?i(v,h):ot(v,n,function(){v.executeSql(t,o,s,i)},i)},i):i(l,h)},i)}function sr(e,n){var t=this;e=N(e);var o=new g(function(s,i){t.ready().then(function(){var l=t._dbInfo;l.db.transaction(function(h){te(h,l,"SELECT * FROM "+l.storeName+" WHERE key = ? LIMIT 1",[e],function(v,_){var p=_.rows.length?_.rows.item(0).value:null;p&&(p=l.serializer.deserialize(p)),s(p)},function(v,_){i(_)})})}).catch(i)});return w(o,n),o}function ur(e,n){var t=this,o=new g(function(s,i){t.ready().then(function(){var l=t._dbInfo;l.db.transaction(function(h){te(h,l,"SELECT * FROM "+l.storeName,[],function(v,_){for(var p=_.rows,S=p.length,E=0;E<S;E++){var T=p.item(E),C=T.value;if(C&&(C=l.serializer.deserialize(C)),C=e(C,T.key,E+1),C!==void 0){s(C);return}}s()},function(v,_){i(_)})})}).catch(i)});return w(o,n),o}function st(e,n,t,o){var s=this;e=N(e);var i=new g(function(l,h){s.ready().then(function(){n===void 0&&(n=null);var v=n,_=s._dbInfo;_.serializer.serialize(n,function(p,S){S?h(S):_.db.transaction(function(E){te(E,_,"INSERT OR REPLACE INTO "+_.storeName+" (key, value) VALUES (?, ?)",[e,p],function(){l(v)},function(T,C){h(C)})},function(E){if(E.code===E.QUOTA_ERR){if(o>0){l(st.apply(s,[e,v,t,o-1]));return}h(E)}})})}).catch(h)});return w(i,t),i}function cr(e,n,t){return st.apply(this,[e,n,t,1])}function lr(e,n){var t=this;e=N(e);var o=new g(function(s,i){t.ready().then(function(){var l=t._dbInfo;l.db.transaction(function(h){te(h,l,"DELETE FROM "+l.storeName+" WHERE key = ?",[e],function(){s()},function(v,_){i(_)})})}).catch(i)});return w(o,n),o}function fr(e){var n=this,t=new g(function(o,s){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(l){te(l,i,"DELETE FROM "+i.storeName,[],function(){o()},function(h,v){s(v)})})}).catch(s)});return w(t,e),t}function dr(e){var n=this,t=new g(function(o,s){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(l){te(l,i,"SELECT COUNT(key) as c FROM "+i.storeName,[],function(h,v){var _=v.rows.item(0).c;o(_)},function(h,v){s(v)})})}).catch(s)});return w(t,e),t}function hr(e,n){var t=this,o=new g(function(s,i){t.ready().then(function(){var l=t._dbInfo;l.db.transaction(function(h){te(h,l,"SELECT key FROM "+l.storeName+" WHERE id = ? LIMIT 1",[e+1],function(v,_){var p=_.rows.length?_.rows.item(0).key:null;s(p)},function(v,_){i(_)})})}).catch(i)});return w(o,n),o}function vr(e){var n=this,t=new g(function(o,s){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(l){te(l,i,"SELECT key FROM "+i.storeName,[],function(h,v){for(var _=[],p=0;p<v.rows.length;p++)_.push(v.rows.item(p).key);o(_)},function(h,v){s(v)})})}).catch(s)});return w(t,e),t}function mr(e){return new g(function(n,t){e.transaction(function(o){o.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(s,i){for(var l=[],h=0;h<i.rows.length;h++)l.push(i.rows.item(h).name);n({db:e,storeNames:l})},function(s,i){t(i)})},function(o){t(o)})})}function _r(e,n){n=B.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var o=this,s;return e.name?s=new g(function(i){var l;e.name===t.name?l=o._dbInfo.db:l=openDatabase(e.name,"","",0),e.storeName?i({db:l,storeNames:[e.storeName]}):i(mr(l))}).then(function(i){return new g(function(l,h){i.db.transaction(function(v){function _(T){return new g(function(C,G){v.executeSql("DROP TABLE IF EXISTS "+T,[],function(){C()},function(j,H){G(H)})})}for(var p=[],S=0,E=i.storeNames.length;S<E;S++)p.push(_(i.storeNames[S]));g.all(p).then(function(){l()}).catch(function(T){h(T)})},function(v){h(v)})})}):s=g.reject("Invalid arguments"),w(s,n),s}var pr={_driver:"webSQLStorage",_initStorage:or,_support:rr(),iterate:ur,getItem:sr,setItem:cr,removeItem:lr,clear:fr,length:dr,key:hr,keys:vr,dropInstance:_r};function gr(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function ut(e,n){var t=e.name+"/";return e.storeName!==n.storeName&&(t+=e.storeName+"/"),t}function yr(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch{return!0}}function br(){return!yr()||localStorage.length>0}function Ir(e){var n=this,t={};if(e)for(var o in e)t[o]=e[o];return t.keyPrefix=ut(e,n._defaultConfig),br()?(n._dbInfo=t,t.serializer=Ce,g.resolve()):g.reject()}function wr(e){var n=this,t=n.ready().then(function(){for(var o=n._dbInfo.keyPrefix,s=localStorage.length-1;s>=0;s--){var i=localStorage.key(s);i.indexOf(o)===0&&localStorage.removeItem(i)}});return w(t,e),t}function Sr(e,n){var t=this;e=N(e);var o=t.ready().then(function(){var s=t._dbInfo,i=localStorage.getItem(s.keyPrefix+e);return i&&(i=s.serializer.deserialize(i)),i});return w(o,n),o}function xr(e,n){var t=this,o=t.ready().then(function(){for(var s=t._dbInfo,i=s.keyPrefix,l=i.length,h=localStorage.length,v=1,_=0;_<h;_++){var p=localStorage.key(_);if(p.indexOf(i)===0){var S=localStorage.getItem(p);if(S&&(S=s.serializer.deserialize(S)),S=e(S,p.substring(l),v++),S!==void 0)return S}}});return w(o,n),o}function Er(e,n){var t=this,o=t.ready().then(function(){var s=t._dbInfo,i;try{i=localStorage.key(e)}catch{i=null}return i&&(i=i.substring(s.keyPrefix.length)),i});return w(o,n),o}function Rr(e){var n=this,t=n.ready().then(function(){for(var o=n._dbInfo,s=localStorage.length,i=[],l=0;l<s;l++){var h=localStorage.key(l);h.indexOf(o.keyPrefix)===0&&i.push(h.substring(o.keyPrefix.length))}return i});return w(t,e),t}function Dr(e){var n=this,t=n.keys().then(function(o){return o.length});return w(t,e),t}function Nr(e,n){var t=this;e=N(e);var o=t.ready().then(function(){var s=t._dbInfo;localStorage.removeItem(s.keyPrefix+e)});return w(o,n),o}function Ar(e,n,t){var o=this;e=N(e);var s=o.ready().then(function(){n===void 0&&(n=null);var i=n;return new g(function(l,h){var v=o._dbInfo;v.serializer.serialize(n,function(_,p){if(p)h(p);else try{localStorage.setItem(v.keyPrefix+e,_),l(i)}catch(S){(S.name==="QuotaExceededError"||S.name==="NS_ERROR_DOM_QUOTA_REACHED")&&h(S),h(S)}})})});return w(s,t),s}function Tr(e,n){if(n=B.apply(this,arguments),e=typeof e!="function"&&e||{},!e.name){var t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}var o=this,s;return e.name?s=new g(function(i){e.storeName?i(ut(e,o._defaultConfig)):i(e.name+"/")}).then(function(i){for(var l=localStorage.length-1;l>=0;l--){var h=localStorage.key(l);h.indexOf(i)===0&&localStorage.removeItem(h)}}):s=g.reject("Invalid arguments"),w(s,n),s}var Cr={_driver:"localStorageWrapper",_initStorage:Ir,_support:gr(),iterate:xr,getItem:Sr,setItem:Ar,removeItem:Nr,clear:wr,length:Dr,key:Er,keys:Rr,dropInstance:Tr},$r=function(n,t){return n===t||typeof n=="number"&&typeof t=="number"&&isNaN(n)&&isNaN(t)},Fr=function(n,t){for(var o=n.length,s=0;s<o;){if($r(n[s],t))return!0;s++}return!1},ct=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},ve={},lt={},ce={INDEXEDDB:tr,WEBSQL:pr,LOCALSTORAGE:Cr},jr=[ce.INDEXEDDB._driver,ce.WEBSQL._driver,ce.LOCALSTORAGE._driver],ge=["dropInstance"],$e=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ge),Gr={description:"",driver:jr.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Mr(e,n){e[n]=function(){var t=arguments;return e.ready().then(function(){return e[n].apply(e,t)})}}function Fe(){for(var e=1;e<arguments.length;e++){var n=arguments[e];if(n)for(var t in n)n.hasOwnProperty(t)&&(ct(n[t])?arguments[0][t]=n[t].slice():arguments[0][t]=n[t])}return arguments[0]}var kr=function(){function e(n){b(this,e);for(var t in ce)if(ce.hasOwnProperty(t)){var o=ce[t],s=o._driver;this[t]=s,ve[s]||this.defineDriver(o)}this._defaultConfig=Fe({},Gr),this._config=Fe({},this._defaultConfig,n),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(t){if((typeof t>"u"?"undefined":m(t))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var o in t){if(o==="storeName"&&(t[o]=t[o].replace(/\W/g,"_")),o==="version"&&typeof t[o]!="number")return new Error("Database version must be a number.");this._config[o]=t[o]}return"driver"in t&&t.driver?this.setDriver(this._config.driver):!0}else return typeof t=="string"?this._config[t]:this._config},e.prototype.defineDriver=function(t,o,s){var i=new g(function(l,h){try{var v=t._driver,_=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver){h(_);return}for(var p=$e.concat("_initStorage"),S=0,E=p.length;S<E;S++){var T=p[S],C=!Fr(ge,T);if((C||t[T])&&typeof t[T]!="function"){h(_);return}}var G=function(){for(var me=function(Pr){return function(){var Br=new Error("Method "+Pr+" is not implemented by the current driver"),ft=g.reject(Br);return w(ft,arguments[arguments.length-1]),ft}},je=0,Lr=ge.length;je<Lr;je++){var Ge=ge[je];t[Ge]||(t[Ge]=me(Ge))}};G();var j=function(me){ve[v]&&console.info("Redefining LocalForage driver: "+v),ve[v]=t,lt[v]=me,l()};"_support"in t?t._support&&typeof t._support=="function"?t._support().then(j,h):j(!!t._support):j(!0)}catch(H){h(H)}});return $(i,o,s),i},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(t,o,s){var i=ve[t]?g.resolve(ve[t]):g.reject(new Error("Driver not found."));return $(i,o,s),i},e.prototype.getSerializer=function(t){var o=g.resolve(Ce);return $(o,t),o},e.prototype.ready=function(t){var o=this,s=o._driverSet.then(function(){return o._ready===null&&(o._ready=o._initDriver()),o._ready});return $(s,t,t),s},e.prototype.setDriver=function(t,o,s){var i=this;ct(t)||(t=[t]);var l=this._getSupportedDrivers(t);function h(){i._config.driver=i.driver()}function v(S){return i._extend(S),h(),i._ready=i._initStorage(i._config),i._ready}function _(S){return function(){var E=0;function T(){for(;E<S.length;){var C=S[E];return E++,i._dbInfo=null,i._ready=null,i.getDriver(C).then(v).catch(T)}h();var G=new Error("No available storage method found.");return i._driverSet=g.reject(G),i._driverSet}return T()}}var p=this._driverSet!==null?this._driverSet.catch(function(){return g.resolve()}):g.resolve();return this._driverSet=p.then(function(){var S=l[0];return i._dbInfo=null,i._ready=null,i.getDriver(S).then(function(E){i._driver=E._driver,h(),i._wrapLibraryMethodsWithReady(),i._initDriver=_(l)})}).catch(function(){h();var S=new Error("No available storage method found.");return i._driverSet=g.reject(S),i._driverSet}),$(this._driverSet,o,s),this._driverSet},e.prototype.supports=function(t){return!!lt[t]},e.prototype._extend=function(t){Fe(this,t)},e.prototype._getSupportedDrivers=function(t){for(var o=[],s=0,i=t.length;s<i;s++){var l=t[s];this.supports(l)&&o.push(l)}return o},e.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,o=$e.length;t<o;t++)Mr(this,$e[t])},e.prototype.createInstance=function(t){return new e(t)},e}(),Or=new kr;c.exports=Or},{3:3}]},{},[4])(4)})}(ke)),ke.exports}var Da=Ra();const Na=dn(Da),qt=Na.createInstance({name:"goals_filter_param"}),Xa=r=>{qt.setItem("goals_filter_param",JSON.parse(JSON.stringify(r)))},Ja=()=>qt.getItem("goals_filter_param");export{ia as C,ea as G,zn as I,Jn as K,Qa as T,de as a,Ka as b,ma as c,fa as d,Q as e,xe as f,Ja as g,ya as h,Wa as i,ha as j,Lt as k,va as l,ze as m,aa as n,na as o,Pt as p,Ue as q,Bt as r,Xa as s,oa as t,Ya as u,Ha as v,sa as w,Va as x};
//# sourceMappingURL=goalsFilterParamLocalForage-C8Yya3Ix.js.map
