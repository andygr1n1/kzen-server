const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ProfileNewPasswordDialog-BKlDRSO7.js","assets/index-Cx9aHWms.js","assets/antd-bK47dtYc.js","assets/react-day-picker-BMg2DGmo.js","assets/index-DY_qxQT6.css","assets/ProtectedRoutes-BInEfiaw.js","assets/formik.esm-ADxEa5mi.js","assets/cn-Bz47sbbS.js","assets/formik-CkMvMzHs.css","assets/useMatchMedia.hook-CVR6FWmx.js","assets/useMutation-D6aZmw1J.js","assets/ProtectedRoutes-Dix7VhZk.css","assets/XDatePicker-6LcKFFPc.js","assets/XTooltip-Bdc9vu0b.js","assets/XDatePicker-yNCoQybG.css","assets/date.helpers-BWySBUrV.js","assets/IconInfiniteLoading-BhfJWl73.js","assets/cropImage-BeABCRIm.js","assets/image.service-CXyyVGKV.js","assets/index--O-lbexr.js"])))=>i.map(i=>d[i]);
import{G as h,u as g,j as e,O as b,P as S,J as C,_ as M,Q as T,aH as w,ab as k}from"./index-Cx9aHWms.js";import{a as q,F as p,e as I,f as v,g as N,P as O,M as U}from"./ProtectedRoutes-BInEfiaw.js";import{u as l,X as P,S as m,a as _,F}from"./formik.esm-ADxEa5mi.js";import{r as j}from"./antd-bK47dtYc.js";import{X as z}from"./XDatePicker-6LcKFFPc.js";import{p as A}from"./date.helpers-BWySBUrV.js";import{j as y}from"./react-day-picker-BMg2DGmo.js";import{I as $}from"./IconInfiniteLoading-BhfJWl73.js";import{c as L}from"./cn-Bz47sbbS.js";import{u as E}from"./useMutation-D6aZmw1J.js";import{I as V,u as B,g as R,K as Q}from"./cropImage-BeABCRIm.js";import{I as W,U as X,u as K,a as Y,d as G}from"./image.service-CXyyVGKV.js";import{c as x}from"./index--O-lbexr.js";const f={instance:"profileService",useProfile$:()=>["useProfile$"]};h.object({editProfile:h.boolean(),editPassword:h.boolean()});const n=()=>{const t=g(),{data:a}=q({queryKey:f.useProfile$(),staleTime:1/0,refetchOnWindowFocus:!1,refetchOnMount:!1,initialData:{editProfile:!1,editPassword:!1}});return{store:a,openEditProfile:()=>{t.setQueryData(f.useProfile$(),{...a,editProfile:!a.editProfile})},openEditPassword:()=>{t.setQueryData(f.useProfile$(),{...a,editPassword:!0})},onCancel:()=>{t.setQueryData(f.useProfile$(),{editProfile:!1,editPassword:!1})},viewMode:!a.editProfile,editPassword:a.editPassword}},H=()=>{const{viewMode:t}=n(),a=l();function r(o){o&&a.setFieldValue("birthday",A(new Date(o)))}function s(){a.setFieldValue("birthday",null)}return e.jsxs("div",{children:[e.jsx(p,{title:"Birthday"}),e.jsx(z,{numberOfMonths:1,mode:"single",selected:a.values.birthday?new Date(a.values.birthday):void 0,onSelect:r,dateFormat:"do MMMM yyyy",captionLayout:"dropdown-buttons",fromYear:y(new Date(Date.now()))-100,toYear:y(new Date(Date.now()))+100,fixedWeeks:!0,showOutsideDays:!0,showWeekNumber:!0,onClear:s,placeholder:"Set date",readOnly:t,showToday:!0})]})},J=()=>{const t=l();return e.jsxs("div",{children:[e.jsx(p,{title:"Email"}),e.jsx(P,{"data-testid":"profile-email-input",disabled:!0,readOnly:!0,autoFocus:!0,value:t.values.email,name:"email",placeholder:"Email",onChange:t.handleChange,error:t.touched.email&&!!t.errors.email,errorMessage:t.errors.email})]})},Z=()=>{const{viewMode:t}=n(),a=l();return e.jsxs("div",{children:[e.jsx(p,{title:"Name"}),e.jsx(P,{"data-testid":"profile-name-input",disabled:t,readOnly:t,autoFocus:!0,value:a.values.name,name:"name",placeholder:"Name",onChange:a.handleChange,error:a.touched.name&&!!a.errors.name,errorMessage:a.errors.name})]})},ee=()=>{const{viewMode:t}=n(),a=l();return e.jsxs("div",{children:[e.jsx(p,{title:"Phone"}),e.jsx(P,{"data-testid":"profile-phone-input",disabled:t,readOnly:t,value:a.values.phone||"",name:"phone",placeholder:"Phone",onChange:a.handleChange,error:a.touched.phone&&!!a.errors.phone,errorMessage:a.errors.phone})]})},D=()=>{const{data:t,isLoading:a}=I(),r=te();return{initialValues:t||r,isLoading:a}},te=()=>({id:crypto.randomUUID(),birthday:null,email:"",name:"",phone:"",avatar:""}),ae=()=>{const{viewMode:t}=n(),{initialValues:a,isLoading:r}=D(),s=l();return j.useEffect(()=>{s.setFormikState(o=>({...o,values:a}))},[t]),{isLoading:r,viewMode:t}};function re(t){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",viewBox:"0 0 24 24",...t,children:e.jsx("path",{fill:"currentColor",d:"M4 19v-1.8q0-.85.438-1.562T5.6 14.55q1.55-.775 3.15-1.162T12 13q.925 0 1.825.113t1.8.362l-1.675 1.7q-.5-.075-.975-.125T12 15q-1.4 0-2.775.338T6.5 16.35q-.225.125-.363.35T6 17.2v.8h6v2H5q-.425 0-.712-.288T4 19m10 1v-1.25q0-.4.163-.763t.437-.637l4.925-4.925q.225-.225.5-.325t.55-.1q.3 0 .575.113t.5.337l.925.925q.2.225.313.5t.112.55t-.1.563t-.325.512l-4.925 4.925q-.275.275-.637.425t-.763.15H15q-.425 0-.712-.288T14 20m7.5-5.575l-.925-.925zm-6 5.075h.95l3.025-3.05l-.45-.475l-.475-.45l-3.05 3.025zm3.525-3.525l-.475-.45l.925.925zM12 12q-1.65 0-2.825-1.175T8 8t1.175-2.825T12 4t2.825 1.175T16 8t-1.175 2.825T12 12m0-2q.825 0 1.413-.587T14 8t-.587-1.412T12 6t-1.412.588T10 8t.588 1.413T12 10m0-2"})})}const se=()=>{const{openEditProfile:t,viewMode:a}=n();return e.jsx("div",{className:L("opacity-70",!a&&"opacity-100"),children:e.jsx(m,{size:"small",startIcon:e.jsx(re,{width:24,height:24}),onClick:t,variant:a?"text":"contained"})})},oe=()=>{const{onCancel:t}=n();return e.jsx(m,{onClick:t,size:"small",error:!0,variant:"outlined",children:"Cancel"})},ie=()=>e.jsx(m,{type:"submit",size:"small",variant:"contained",children:"Save"}),ne=()=>{const{isLoading:t,viewMode:a}=ae();return e.jsxs(_,{children:[e.jsxs("div",{className:"flex items-center justify-between my-1 ",children:[e.jsx("div",{className:"flex gap-2",children:e.jsx(se,{})}),!a&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(oe,{}),e.jsx(ie,{})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 bg-global-2-bg p-5 rounded-md shadow-[rgba(0,_0,_0,_0.24)_0px_3px_8px] pl-5",children:[t&&e.jsx("div",{className:"w-full h-full z-[100] bg-global-bg-plasma left-0 flex items-center duration-300 justify-center top-0 fixed",children:e.jsx($,{className:"w-20 h-20 text-blue-500 duration-300"})}),e.jsx(J,{}),e.jsx(Z,{}),e.jsx(ee,{}),e.jsx(H,{})]})]})},le=()=>({validate:a=>{const r=v.safeParse(a),s={};if(!r.success)for(const o of r.error.issues){const i=o.path[0];s[i]=o.message}return a.name.length||(s.name="Required field"),s}}),ue=async({userProfile:t})=>{var a,r;try{const s=await b(),{id:o,email:i,...u}=t,c=S(`
            mutation mutation_updateUserProfile($userProfile: heroes_set_input!) {
                update_heroes(where: {}, _set: $userProfile) {
                    returning {
                        id
                        avatar
                        birthday
                        email
                        name
                        phone
                    }
                }
            }
        `),d=await s.request(c,{userProfile:u});return v.parse((r=(a=d==null?void 0:d.update_heroes)==null?void 0:a.returning)==null?void 0:r[0])}catch(s){return await C(s)}},ce=()=>{const t=g(),a=E({mutationFn:({userProfile:s})=>ue({userProfile:s}),onSuccess:()=>{t.invalidateQueries()}});return{updateUserProfile:({userProfile:s,onSuccess:o,onSettled:i})=>{a.mutate({userProfile:s},{onSuccess:o,onSettled:i})}}},de=()=>{const{onCancel:t}=n(),{updateUserProfile:a}=ce();return{onSubmit:(s,o)=>{const{setSubmitting:i}=o;a({userProfile:s,onSuccess:()=>{t()},onSettled:()=>{i(!1)}})}}};function me(t){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",viewBox:"0 0 24 24",...t,children:e.jsx("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 17v4m-2-1l4-2m-4 0l4 2m-9-3v4m-2-1l4-2m-4 0l4 2m12-3v4m-2-1l4-2m-4 0l4 2M9 6a3 3 0 1 0 6 0a3 3 0 0 0-6 0m-2 8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2"})})}const fe=j.lazy(()=>M(()=>import("./ProfileNewPasswordDialog-BKlDRSO7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]))),pe=()=>{const{openEditPassword:t}=n();return e.jsxs("div",{className:"opacity-70 absolute left-10 top-1",children:[e.jsx(m,{size:"small",startIcon:e.jsx(me,{width:24,height:24}),onClick:t,variant:"text"}),e.jsx(j.Suspense,{fallback:null,children:e.jsx(fe,{})})]})},he=()=>{const{onSubmit:t}=de(),{validate:a}=le(),{initialValues:r}=D();return e.jsxs("div",{className:"relative",children:[e.jsx(pe,{}),e.jsx(F,{enableReinitialize:!0,initialValues:r,validate:a,onSubmit:t,children:e.jsx(ne,{})})]})},xe=()=>{const t=l(),{imgSrc:a}=t.values;return e.jsx(N,{title:"Avatar",open:!!a,onCancel:t.resetForm,children:a&&e.jsxs("div",{className:"text-cText m-auto flex  flex-col bg-transparent",children:[e.jsx(V,{imgPath:a}),e.jsx(m,{disabled:t.isSubmitting,className:"w-full",onClick:()=>t.handleSubmit(),children:"Save"})]})})},ge=()=>e.jsx("div",{className:`w-full h-full flex absolute opacity-0 group-hover:opacity-100 top-0 z-10 transition-all 
            rounded-full duration-300 items-center justify-center bg-blue-100/20`,children:e.jsx(W,{className:"min-w-[50px] min-h-[50px] text-blue-600 "})}),ve=()=>{const t=l(),a=r=>{K(r,s=>{t.setFieldValue("imgSrc",s)})};return e.jsxs("div",{"data-testid":"profile-avatar-index",className:"group relative mx-auto w-fit rounded-full",children:[e.jsx(O,{}),e.jsx(ge,{}),e.jsx(X,{onChange:a})]})},Pe=async({imgPath:t})=>{var a,r;try{const s=await b(),o=S(`
            mutation mutation_updateAvatar($avatar: String!) {
                update_heroes(where: {}, _set: { avatar: $avatar }) {
                    returning {
                        id
                        avatar
                        birthday
                        email
                        name
                        phone
                    }
                }
            }
        `),i=await s.request(o,{avatar:t});return v.parse((r=(a=i==null?void 0:i.update_heroes)==null?void 0:a.returning)==null?void 0:r[0])}catch(s){return await C(s)}},je=()=>{const t=g(),{id:a}=T(),{data:r}=I(),{getCropArea:s}=B(),o=E({mutationFn:async({values:u})=>{if(!u.imgSrc)return;const c=await R(u.imgSrc,x(s())),d=await Y({img:x(c),route:w.PROFILE_IMAGE_UPLOAD,userId:a});return r!=null&&r.avatar&&await G(r.avatar,w.PROFILE_IMAGE_DELETE),Pe({imgPath:x(d)})}});return{onSubmit:(u,c)=>{o.mutate({values:u},{onSuccess:()=>{c.resetForm(),k(`
                        Avatar successfully updated. Thank you!`)},onSettled:()=>{c.setSubmitting(!1),t.resetQueries({queryKey:Q()}),t.invalidateQueries()}})}}},we=()=>{const{onSubmit:t}=je();return e.jsx(e.Fragment,{children:e.jsx(F,{enableReinitialize:!0,initialValues:{imgSrc:""},onSubmit:t,children:e.jsxs(_,{className:"flex flex-col gap-5",children:[e.jsx(ve,{}),e.jsx(xe,{})]})})})},ye=()=>e.jsx(U,{children:e.jsxs("div",{className:"flex flex-col gap-10 w-full max-w-[600px] mx-auto relative",children:[e.jsx(we,{}),e.jsx(he,{})]})}),Oe=Object.freeze(Object.defineProperty({__proto__:null,default:ye},Symbol.toStringTag,{value:"Module"}));export{J as P,Oe as a,n as u};
//# sourceMappingURL=ProfileIndex-rBHi4SyT.js.map
